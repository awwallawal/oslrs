# Story 2.5.4: Supervisor Dashboard Shell

Status: done

## Story

As a Supervisor,
I want my dashboard to show team overview and fraud alerts,
So that I can monitor my enumerators and investigate suspicious activity.

## Acceptance Criteria

### AC1: Supervisor Dashboard Home
**Given** a Supervisor logging in, **when** they reach `/dashboard/supervisor`, **then** they see a team-focused dashboard with:
- **Team Overview card** - shows placeholder enumerator count (0) and active/inactive status breakdown (no API yet — real data comes in Epic 4)
- **Pending Alerts card** (placeholder) - shows "No alerts yet" empty state with AlertTriangle icon
- **Today's Collection card** - shows "Coming in Epic 3" placeholder with collection count = 0
- **Last Updated timestamp** with a manual refresh button (RefreshCw icon)

### AC2: Team Overview Detail
**Given** the Team Overview card, **when** clicked, **then** navigate to `/dashboard/supervisor/team` which shows a list of the supervisor's assigned enumerators with status indicators (online/offline/syncing placeholder badges).

> **Note:** For this shell story, the team list page is a placeholder. It renders a card-based list with mock structure (no API call yet - enumerator assignment is Epic 4). Show an empty state: "No enumerators assigned yet. Team assignments will be available in a future update."

### AC3: Sidebar Navigation
**Given** the sidebar navigation, **then** Supervisor sees exactly 4 items matching the existing `sidebarConfig.ts`:
- Dashboard (Home icon) - `/dashboard/supervisor`
- Team Progress (Users icon) - `/dashboard/supervisor/team`
- Fraud Alerts (AlertTriangle icon) - `/dashboard/supervisor/fraud`
- Messages (MessageSquare icon) - `/dashboard/supervisor/messages`

> **Note:** sidebarConfig.ts already has 6 items for supervisor (including Assignments and Reports). The AC says 4 items. Update sidebarConfig.ts to remove "Assignments" and "Reports" entries for supervisor role to match the AC requirement of 4 items exactly.

### AC4: Route Guards (RBAC)
**Given** route guards, **when** a Supervisor tries to access `/dashboard/super-admin/*` or `/dashboard/enumerator`, **then** they receive access denied and redirect to `/unauthorized`.

> **Already implemented** in Story 2.5-1 via `ProtectedRoute allowedRoles={['supervisor']}` wrapping supervisor routes. Verified by 53 RBAC tests in `rbac-routes.test.tsx`. No new RBAC work needed - just verify existing tests still pass.

## Tasks / Subtasks

- [x] Task 1: Update sidebarConfig.ts (AC: #3)
  - [x] 1.1 Remove "Assignments" and "Reports" nav items from `supervisor` array in sidebarConfig.ts (reduce from 6 to 4 items)
  - [x] 1.2 Update sidebarConfig.test.ts to expect 4 items for supervisor role
- [x] Task 2: Build SupervisorHome dashboard page (AC: #1)
  - [x] 2.1 Replace placeholder `SupervisorHome.tsx` with real dashboard layout
  - [x] 2.2 Create Team Overview card (Card + Users icon + placeholder count)
  - [x] 2.3 Create Pending Alerts card (Card + AlertTriangle icon + empty state)
  - [x] 2.4 Create Today's Collection card (Card + placeholder "Coming in Epic 3")
  - [x] 2.5 Add Last Updated timestamp display with RefreshCw button
  - [x] 2.6 Use `SkeletonCard` components during loading state (skeleton shimmer, NOT spinners). Since no API hook exists yet, hardcode `const isLoading = false;` — the skeleton branch still must exist in JSX so tests can verify it, but it won't render in normal use. When a real supervisor stats hook is added in Epic 4, swap the hardcoded value for the hook's `isLoading`.
- [x] Task 3: Build Team page placeholder (AC: #2) — page component only, route registered in Task 6
  - [x] 3.1 Create `SupervisorTeamPage.tsx` in `apps/web/src/features/dashboard/pages/`
  - [x] 3.2 Show empty state: "No enumerators assigned yet" message with Users icon
- [x] Task 4: Build Fraud Alerts placeholder page (AC: #3 sidebar link target) — page component only, route registered in Task 6
  - [x] 4.1 Create `SupervisorFraudPage.tsx` in `apps/web/src/features/dashboard/pages/`
  - [x] 4.2 Show empty state: "No fraud alerts" with Shield icon
- [x] Task 5: Build Messages placeholder page (AC: #3 sidebar link target) — page component only, route registered in Task 6
  - [x] 5.1 Create `SupervisorMessagesPage.tsx` in `apps/web/src/features/dashboard/pages/`
  - [x] 5.2 Show empty state: "No messages yet" with MessageSquare icon
- [x] Task 6: Register new routes in App.tsx (AC: #2, #3)
  - [x] 6.1 Lazy-load `SupervisorTeamPage`, `SupervisorFraudPage`, `SupervisorMessagesPage`
  - [x] 6.2 Add child routes under the existing supervisor `<Route path="supervisor">` block in App.tsx (search by structure, not line numbers)
  - [x] 6.3 Kept wildcard `<Route path="*">` as final catch-all after all 3 sub-routes
- [x] Task 7: Write tests (AC: #1, #2, #3, #4)
  - [x] 7.1 Create `SupervisorHome.test.tsx` - renders 3 cards, refresh button, navigation, skeleton branch
  - [x] 7.2 Create `SupervisorTeamPage.test.tsx` - renders empty state
  - [x] 7.3 Create `SupervisorFraudPage.test.tsx` - renders empty state
  - [x] 7.4 Create `SupervisorMessagesPage.test.tsx` - renders empty state
  - [x] 7.5 Verify existing RBAC tests still pass (run full test suite) — 796/796 pass, 0 regressions

### Review Follow-ups (AI)
- [x] [AI-Review][HIGH] Fix stale comments in sidebarConfig.ts — lines 9 and 96 say "6-8 items" but supervisor now has 4 items [sidebarConfig.ts:9,96]
- [x] [AI-Review][MEDIUM] Fix test comment claiming "4 dashboard cards" when test asserts 3 [SupervisorHome.test.tsx:8]
- [x] [AI-Review][MEDIUM] Fix refresh timestamp test to actually verify value changes [SupervisorHome.test.tsx:94-101]
- [x] [AI-Review][MEDIUM] Add icon verification to component tests [SupervisorHome.test.tsx, placeholder page tests]
- [x] [AI-Review][LOW] Add sprint-status.yaml to File List [story file]
- [x] [AI-Review][LOW] Update test mock pattern to use vi.hoisted() per project convention [SupervisorHome.test.tsx:22-29]

## Dev Notes

### Architecture Compliance

- **Layout:** Uses existing `DashboardLayout` from Story 2.5-1 - do NOT create a new layout
- **Route protection:** Already handled by `ProtectedRoute allowedRoles={['supervisor']}` in App.tsx line 566
- **Loading states:** MUST use `SkeletonCard` from `apps/web/src/components/skeletons/` - NEVER spinners (ADR-016, project-context.md anti-pattern #5)
- **Icons:** Use lucide-react icons already imported in sidebarConfig.ts: `Home`, `Users`, `AlertTriangle`, `MessageSquare`, `RefreshCw`
- **Card components:** Use `Card`, `CardHeader`, `CardTitle`, `CardContent` from `apps/web/src/components/ui/card.tsx`
- **Styling:** Tailwind CSS v4 classes. Follow the SuperAdminHome.tsx card pattern exactly (icon in colored circle + ChevronRight for clickable cards)

### Established Patterns to Follow

**Dashboard card pattern** (from `SuperAdminHome.tsx`):
```tsx
<Card className="cursor-pointer hover:shadow-md transition-shadow" onClick={() => navigate('/...')}>
  <CardHeader className="pb-2">
    <div className="flex items-center justify-between">
      <div className="flex items-center gap-2">
        <div className="p-2 bg-{color}-100 rounded-lg">
          <Icon className="w-5 h-5 text-{color}-600" />
        </div>
        <CardTitle className="text-base">Title</CardTitle>
      </div>
      <ChevronRight className="w-5 h-5 text-neutral-400" />
    </div>
  </CardHeader>
  <CardContent>...</CardContent>
</Card>
```

**Page header pattern** (from all dashboard home pages):
```tsx
<div className="p-6">
  <div className="mb-6">
    <h1 className="text-2xl font-brand font-semibold text-neutral-900">
      Supervisor Dashboard
    </h1>
    <p className="text-neutral-600 mt-1">
      Team management and oversight tools
    </p>
  </div>
  {/* cards grid */}
</div>
```

**Skeleton loading pattern** (from `SuperAdminHome.tsx`):
```tsx
{isLoading ? (
  <div className="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
    <SkeletonCard />
    <SkeletonCard />
    <SkeletonCard />
  </div>
) : (
  <div className="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
    {/* actual cards */}
  </div>
)}
```

**Lazy route registration pattern** (from App.tsx):
```tsx
const SupervisorTeamPage = lazy(() => import('./features/dashboard/pages/SupervisorTeamPage'));
// ... inside supervisor Route block:
<Route path="team" element={<Suspense fallback={<DashboardLoadingFallback />}><SupervisorTeamPage /></Suspense>} />
```

**Empty state pattern** for placeholder pages:
```tsx
<div className="p-6">
  <div className="mb-6">
    <h1 className="text-2xl font-brand font-semibold text-neutral-900">Page Title</h1>
    <p className="text-neutral-600 mt-1">Description</p>
  </div>
  <Card>
    <CardContent className="flex flex-col items-center justify-center py-16 text-center">
      <Icon className="w-12 h-12 text-neutral-300 mb-4" />
      <p className="text-neutral-500 font-medium">Empty state message</p>
      <p className="text-sm text-neutral-400 mt-1">Helpful sub-text</p>
    </CardContent>
  </Card>
</div>
```

### Color Scheme for Supervisor Cards

Follow the established icon-background color pattern from SuperAdminHome:
- **Team Overview:** `bg-blue-100` / `text-blue-600` (Users icon) - team/people color
- **Pending Alerts:** `bg-amber-100` / `text-amber-600` (AlertTriangle icon) - warning color
- **Today's Collection:** `bg-emerald-100` / `text-emerald-600` (activity/collection)
- **Refresh button:** neutral styling, not a card - placed in the header area

### Project Structure Notes

**New files to create:**
```
apps/web/src/features/dashboard/pages/
  SupervisorTeamPage.tsx          # Team list placeholder
  SupervisorFraudPage.tsx         # Fraud alerts placeholder
  SupervisorMessagesPage.tsx      # Messages placeholder
  __tests__/SupervisorHome.test.tsx
  __tests__/SupervisorTeamPage.test.tsx
  __tests__/SupervisorFraudPage.test.tsx
  __tests__/SupervisorMessagesPage.test.tsx
```

**Files to modify:**
```
apps/web/src/features/dashboard/pages/SupervisorHome.tsx    # Replace placeholder with real dashboard
apps/web/src/features/dashboard/config/sidebarConfig.ts     # Remove 2 items from supervisor (6 -> 4)
apps/web/src/App.tsx                                         # Add 3 new supervisor child routes
apps/web/src/features/dashboard/__tests__/sidebarConfig.test.ts  # Update supervisor item count
```

### sidebarConfig.ts Change Detail

Current supervisor config (6 items):
```ts
supervisor: [
  { label: 'Home', href: '/dashboard/supervisor', icon: Home },
  { label: 'Team Progress', href: '/dashboard/supervisor/team', icon: Users },
  { label: 'Assignments', href: '/dashboard/supervisor/assignments', icon: ClipboardList },  // REMOVE
  { label: 'Fraud Alerts', href: '/dashboard/supervisor/fraud', icon: AlertTriangle },
  { label: 'Messages', href: '/dashboard/supervisor/messages', icon: MessageSquare },
  { label: 'Reports', href: '/dashboard/supervisor/reports', icon: BarChart },               // REMOVE
],
```

Target (4 items per AC3):
```ts
supervisor: [
  { label: 'Home', href: '/dashboard/supervisor', icon: Home },
  { label: 'Team Progress', href: '/dashboard/supervisor/team', icon: Users },
  { label: 'Fraud Alerts', href: '/dashboard/supervisor/fraud', icon: AlertTriangle },
  { label: 'Messages', href: '/dashboard/supervisor/messages', icon: MessageSquare },
],
```

After removing, check if `ClipboardList` and `BarChart` imports are still used by other roles before removing from imports. `ClipboardList` is used by `public_user` and `BarChart` is used by `clerk` - so do NOT remove the imports.

### Test Strategy

- **Unit tests:** Each new page component renders correctly with expected elements
- **SupervisorHome tests:** Renders 4 cards by name, shows skeletons when loading, refresh button exists, clicking Team Overview navigates to `/dashboard/supervisor/team`
- **Placeholder page tests:** Each renders correct heading and empty state message
- **Regression:** Run full test suite to verify RBAC tests and existing sidebarConfig tests still pass
- **Test location:** Page tests go in `apps/web/src/features/dashboard/pages/__tests__/` (matches SuperAdminHome.test.tsx convention); config tests (sidebarConfig) stay in `apps/web/src/features/dashboard/__tests__/`
- **Mocking pattern:** Use `vi.hoisted()` + `vi.mock()` for react-router-dom `useNavigate`

### References

- [Source: epics.md, Story 2.5-4, lines 949-961]
- [Source: architecture.md, ADR-016 Layout Architecture]
- [Source: ux-design-specification.md, Section 3 Role-specific navigation]
- [Source: project-context.md, Anti-pattern #5 (no spinners)]
- [Source: 2.5-1-dashboard-layout-architecture-role-routing.md, File List and Patterns]
- [Source: SuperAdminHome.tsx, Card pattern reference]
- [Source: sidebarConfig.ts, Current supervisor nav items]

### Previous Story Intelligence

**From Story 2.5-1 (Dashboard Layout):**
- DashboardLayout, DashboardSidebar, DashboardHeader, DashboardBottomNav all established
- `sidebarConfig.ts` drives all nav items - this is the single source of truth for sidebar
- Route guard pattern: `ProtectedRoute allowedRoles={['supervisor']}` wrapping `<Outlet />`
- Placeholder pages follow consistent pattern: page title + subtitle + skeleton cards
- 99 tests added in 2.5-1; current total ~780 web tests

**From Story 2.5-2 (Super Admin Questionnaires):**
- `SuperAdminHome.tsx` is the reference implementation for dashboard cards
- Uses `useNavigate()` for card click navigation
- `SkeletonCard` for loading states
- Card grid: `grid gap-6 md:grid-cols-2 lg:grid-cols-3`

**From Story 2.5-3 (Staff Management):**
- Established the staff table, dialogs, and API hook patterns
- Code review found and fixed 8 issues across 2 review cycles
- Total test count reached 766 web + 247 API after this story

**Git Recent Commits (relevant):**
- `09dea56` feat: Native Form Builder UI (Story 2.10) - latest
- `5f765d4` fix: resolve all 8 code review issues for Story 2.5-3
- `d43b128` feat: activation wizard UX fixes, staff reactivation, ID card redesign

### What NOT To Do

- Do NOT create any API endpoints or backend services - this is a frontend-only shell story
- Do NOT fetch real enumerator/team data - no API exists yet (Epic 4)
- Do NOT implement actual fraud detection UI - that's Epic 4 Story 4-3/4-4
- Do NOT implement actual messaging - that's Epic 4 Story 4-2
- Do NOT add service worker logic - that's Epic 3 Story 3-2
- Do NOT create a new layout component - use existing DashboardLayout
- Do NOT use spinners for loading states - use SkeletonCard only
- Do NOT add the supervisor role to any other role's routes

## Dev Agent Record

### Agent Model Used

Claude Opus 4.6

### Debug Log References

- SupervisorHome.test.tsx initial failure: `CardTitle` renders as `div[data-slot="card-title"]` not `h3`. Fixed test to use `querySelectorAll('[data-slot="card-title"]')`.

### Completion Notes List

- Task 1: Removed "Assignments" and "Reports" from supervisor sidebarConfig (6 → 4 items per AC3). Updated test assertion. ClipboardList/BarChart imports retained (used by other roles).
- Task 2: Replaced placeholder SupervisorHome with 3-card dashboard: Team Overview (blue, clickable → /team), Pending Alerts (amber, empty state), Today's Collection (emerald, placeholder). Added Last Updated timestamp + RefreshCw button. Skeleton branch with `isLoading = false` hardcoded.
- Tasks 3-5: Created SupervisorTeamPage (Users icon, empty state), SupervisorFraudPage (Shield icon, empty state), SupervisorMessagesPage (MessageSquare icon, empty state). All follow established empty state pattern.
- Task 6: Added 3 lazy imports + 3 child routes (team, fraud, messages) under supervisor Route block. Kept wildcard catch-all.
- Task 7: Created 4 test files (16 new tests total). Full regression suite: 796/796 pass, 0 regressions.

### File List

**New files:**
- `apps/web/src/features/dashboard/pages/SupervisorTeamPage.tsx`
- `apps/web/src/features/dashboard/pages/SupervisorFraudPage.tsx`
- `apps/web/src/features/dashboard/pages/SupervisorMessagesPage.tsx`
- `apps/web/src/features/dashboard/pages/__tests__/SupervisorHome.test.tsx`
- `apps/web/src/features/dashboard/pages/__tests__/SupervisorTeamPage.test.tsx`
- `apps/web/src/features/dashboard/pages/__tests__/SupervisorFraudPage.test.tsx`
- `apps/web/src/features/dashboard/pages/__tests__/SupervisorMessagesPage.test.tsx`

**Modified files:**
- `apps/web/src/features/dashboard/pages/SupervisorHome.tsx` — replaced placeholder with real dashboard
- `apps/web/src/features/dashboard/config/sidebarConfig.ts` — removed 2 supervisor nav items, updated comments
- `apps/web/src/features/dashboard/__tests__/sidebarConfig.test.ts` — updated supervisor count assertion
- `apps/web/src/App.tsx` — added 3 lazy imports + 3 supervisor child routes
- `_bmad-output/implementation-artifacts/sprint-status.yaml` — updated story status

### Change Log

- 2026-02-08: Story 2.5-4 implemented — Supervisor dashboard shell with team overview, alerts, collection cards, 3 placeholder pages, 4 sidebar nav items, 16 new tests (796 total web tests)
- 2026-02-08: Code review — 6 findings (1H, 3M, 2L), all fixed: updated stale sidebarConfig comments (6-8→4), fixed test comment (4→3 cards), improved refresh timestamp test with fake timers, added 4 icon verification tests, updated File List, adopted vi.hoisted() pattern. 800 total web tests (800/800 pass).
