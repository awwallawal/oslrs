# Story 2.5.7: Verification Assessor & Government Official Dashboards

Status: done

## Story

As a Verification Assessor or Government Official,
I want my dashboard with appropriate data views,
so that I can perform audits (Assessor) or view read-only reports (Official).

## Acceptance Criteria

**Verification Assessor Dashboard (`/dashboard/assessor`):**

1. **Given** a Verification Assessor at `/dashboard/assessor`, **when** the page loads, **then** they see an audit-focused dashboard with Verification Queue card (placeholder count), Recent Activity card, Evidence Panel placeholder, and quick filters (By LGA, By Enumerator, By Date Range).
2. **Given** the UX spec evidence display requirement, **then** Assessor dashboard includes placeholder area for GPS clustering, completion times, and response patterns (Epic 5 wiring).

**Government Official Dashboard (`/dashboard/official`):**

3. **Given** a Government Official at `/dashboard/official`, **when** the page loads, **then** they see a read-only Reports Dashboard with State Overview card, Collection Progress card, Export Data card (placeholder button inside), and formal styling per Direction 08.
4. **Given** all Government Official dashboard elements, **when** rendered, **then** they are READ-ONLY (no edit/action buttons except export).
5. **Given** the formal interface requirement, **then** the Government Official dashboard uses Direction 08 styling from ux-design-directions.html.

**Shared Requirements:**

6. **Given** route isolation, **when** Assessor tries to access Official routes (or vice versa), **then** they are redirected to their own dashboard via `ProtectedRoute` → `DashboardRedirect`.
7. **Given** either role attempts to access `/dashboard/super-admin/*`, **then** they are redirected to their own dashboard (enforced via `ProtectedRoute redirectTo="/dashboard"`).
8. **Given** both dashboards, **when** loading, **then** SkeletonCard components render (not spinners) — consistent with all other dashboard shells.
9. **Given** both dashboards, **then** lazy-loaded sub-pages use Suspense with DashboardLoadingFallback.
10. **Given** both dashboards, **then** tab navigation through interactive elements works without focus traps.

## Tasks / Subtasks

- [x] Task 1: Implement AssessorHome dashboard (AC: 1, 2, 8, 10)
  - [x] 1.1 Replace placeholder in `AssessorHome.tsx` with full dashboard
  - [x] 1.2 Add Verification Queue card (amber, FileSearch icon, "0 pending" counter)
  - [x] 1.3 Add Recent Activity card (blue, Activity icon, empty state)
  - [x] 1.4 Add Evidence Panel placeholder (red/purple, Shield icon) with "GPS clustering, completion times, response patterns" labels and "Coming in Epic 5" note
  - [x] 1.5 Add Quick Filters section (3 placeholder filter dropdowns: By LGA, By Enumerator, By Date Range)
  - [x] 1.6 Add SkeletonCard loading branch with `isLoading` prop

- [x] Task 2: Implement OfficialHome dashboard with Direction 08 styling (AC: 3, 4, 5, 8, 10)
  - [x] 2.1 Replace placeholder in `OfficialHome.tsx` with formal Direction 08 dashboard
  - [x] 2.2 Apply Direction 08 styling: dark header accent (`bg-gray-800 text-white`), section headers with left maroon border (`border-l-4 border-[#9C1E23]`), field groups with `bg-gray-50` backgrounds, formal typography
  - [x] 2.3 Add State Overview card (slate, PieChart icon, read-only stats placeholders)
  - [x] 2.4 Add Collection Progress card (emerald, TrendingUp icon, read-only progress display)
  - [x] 2.5 Add Export Data card (blue, Download icon) with "Export Report" button inside — opens "Coming in Epic 5" modal
  - [x] 2.6 Ensure ALL elements are read-only: no edit buttons, no action buttons except Export
  - [x] 2.7 Add SkeletonCard loading branch with `isLoading` prop

- [x] Task 3: Add sub-pages for Assessor (AC: 9)
  - [x] 3.1 Create `AssessorQueuePage.tsx` with empty-state pattern (FileSearch icon, "Verification queue will be available in Epic 5")
  - [x] 3.2 Create `AssessorCompletedPage.tsx` with empty-state pattern (CheckCircle icon, "Completed reviews will appear here")
  - [x] 3.3 Create `AssessorEvidencePage.tsx` with empty-state pattern (Shield icon, "Evidence panel will be available in Epic 5")

- [x] Task 4: Add sub-pages for Official (AC: 9)
  - [x] 4.1 Create `OfficialStatsPage.tsx` with empty-state pattern (PieChart icon, "Statistics will be available in Epic 5")
  - [x] 4.2 Create `OfficialTrendsPage.tsx` with empty-state pattern (TrendingUp icon, "Trend analysis will be available in Epic 5")
  - [x] 4.3 Create `OfficialExportPage.tsx` with empty-state pattern (Download icon, "Export functionality will be available in Epic 5")

- [x] Task 5: Update App.tsx routes (AC: 6, 7, 9)
  - [x] 5.1 Add lazy imports for all 6 new sub-pages
  - [x] 5.2 Add child routes under assessor path: queue, completed, evidence
  - [x] 5.3 Add child routes under official path: stats, trends, export
  - [x] 5.4 All sub-routes wrapped in Suspense + DashboardLoadingFallback

- [x] Task 6: Write tests (AC: 1-10)
  - [x] 6.1 Create `AssessorHome.test.tsx` — test all AC1-2 cards, filters, skeleton loading, tab navigation
  - [x] 6.2 Create `OfficialHome.test.tsx` — test all AC3-5 cards, read-only enforcement, Direction 08 styling, skeleton loading, tab navigation
  - [x] 6.3 Create `AssessorSubPages.test.tsx` — test 3 sub-pages render with empty states
  - [x] 6.4 Create `OfficialSubPages.test.tsx` — test 3 sub-pages render with empty states
  - [x] 6.5 Update `sidebarConfig.test.ts` — verify assessor has 4 items, official has 4 items (if not already covered)
  - [x] 6.6 RBAC tests: Assessor accessing `/dashboard/official` is redirected, Official accessing `/dashboard/assessor` is redirected, both accessing `/dashboard/super-admin` are redirected — verify `ProtectedRoute` renders redirect for wrong role (AC6, AC7)

- [x] Task 7: Fix frontend role name mismatch — clerk/assessor/official Access Denied bug
  - **Root cause:** Database/API returns full role names (`data_entry_clerk`, `verification_assessor`, `government_official`) but the frontend `ProtectedRoute.allowedRoles` and `sidebarConfig` used short names (`clerk`, `assessor`, `official`). The `ProtectedRoute` role comparison failed, redirecting to `/unauthorized`. Super Admin, Supervisor, Enumerator, and Public User were unaffected (names match at both layers).
  - **Rename map:** `clerk` → `data_entry_clerk`, `assessor` → `verification_assessor`, `official` → `government_official`. URL paths (`/dashboard/clerk`, etc.) and display names unchanged.
  - [x] 7.1 Update `sidebarConfig.ts` — `UserRole` type union, all Record keys (`roleRouteMap`, `roleDisplayNames`, `sidebarConfig`), `ALL_ROLES` array values
  - [x] 7.2 Update `App.tsx` — 3 `allowedRoles` arrays: `['clerk']` → `['data_entry_clerk']`, `['assessor']` → `['verification_assessor']`, `['official']` → `['government_official']`
  - [x] 7.3 Update `sidebarConfig.test.ts` — item count test names/keys, `getRoleDisplayName` assertion, `expectedRoutes` record keys
  - [x] 7.4 Update `rbac-routes.test.tsx` — `ALL_ROLES` array, `ROLE_ROUTES` keys, `allowedRoles` in ProtectedRoute renders, `createMockUser` calls, `data-testid` values, `replaceAll` for multi-underscore roles
  - [x] 7.5 Update `DashboardRedirect.test.tsx` — role values and descriptions in `roleRedirectTestCases`
  - [x] 7.6 Update `DashboardLayout.test.tsx` — role values in `roleTestCases`
  - [x] 7.7 Update `AssessorOfficialRbac.test.tsx` — `mockAuth()` arguments, `allowedRoles` arrays, `required-roles` text content assertions
  - [x] 7.8 Full test suite verification — 917 tests pass, zero remaining short role identifiers

## Dev Notes

### Architecture Compliance

- **Loading states:** SkeletonCard components (NEVER spinners) — per ADR-016, project-context.md
- **Lazy loading:** All pages use `React.lazy()` + `<Suspense fallback={<DashboardLoadingFallback />}>` — established in Story 2.5-1
- **RBAC:** Routes guarded via `<ProtectedRoute allowedRoles={['verification_assessor']}>`/`['government_official']` in App.tsx — cross-role 403 verified
- **Sidebar:** Configured in `sidebarConfig.ts` with correct items and icons for both roles
- **Role mapping:** `verification_assessor` and `government_official` in `roleRouteMap`, `roleDisplayNames`, and `ALL_ROLES` (renamed from short names in Task 7)

### Direction 08 Styling (Government Official Only)

Direction 08 is the "formal government" visual treatment:
- **Dark header accent:** Use `bg-gray-800 text-white` for a top dashboard bar or card header accent strip
- **Section headers:** Left maroon border `border-l-4 border-[#9C1E23]` with `pl-4`
- **Field groups:** `bg-gray-50 border border-gray-200 rounded-lg p-5` for card content areas
- **Typography:** Poppins for headings (already `font-brand`), slightly more formal spacing
- **Color restraint:** Mostly neutral (gray-800, gray-600, gray-50) with Oyo maroon (`#9C1E23`) accents only
- **Read-only emphasis:** No primary action buttons, no edit icons, no form inputs — only Export placeholder

This is NOT a full page theme rewrite. Apply Direction 08 as accent styling within the existing DashboardLayout.

### Grid Layout

Both Assessor (3 cards + filters) and Official (3 cards) use `grid gap-6 md:grid-cols-2 lg:grid-cols-3` so all 3 cards fit on desktop while stacking cleanly on tablet.

### Component Patterns to Reuse

All dashboard homes follow the same pattern — reference `ClerkHome.tsx`, `SupervisorHome.tsx`, `EnumeratorHome.tsx`:

```
<div className="p-6">
  {/* Page Header */}
  <div className="mb-6">
    <h1 className="text-2xl font-brand font-semibold text-neutral-900">Title</h1>
    <p className="text-neutral-600 mt-1">Subtitle</p>
  </div>

  {isLoading ? (
    <div className="grid gap-6 md:grid-cols-2"><SkeletonCard /><SkeletonCard /></div>
  ) : (
    <div className="grid gap-6 md:grid-cols-2">
      {/* Cards with icon-in-colored-background pattern */}
      <Card>
        <CardHeader className="pb-2">
          <div className="flex items-center gap-2">
            <div className="p-2 bg-[color]-100 rounded-lg">
              <Icon className="w-5 h-5 text-[color]-600" />
            </div>
            <CardTitle className="text-base">Card Title</CardTitle>
          </div>
        </CardHeader>
        <CardContent>...</CardContent>
      </Card>
    </div>
  )}
</div>
```

### Sub-page Empty State Pattern

All sub-pages follow the same structure — reference `ClerkQueuePage.tsx`, `EnumeratorDraftsPage.tsx`:

```
export default function PageName() {
  return (
    <div className="p-6">
      <h1 className="text-2xl font-brand font-semibold text-neutral-900 mb-6">Page Title</h1>
      <div className="flex flex-col items-center justify-center py-16 text-center">
        <Icon className="w-12 h-12 text-neutral-300 mb-4" />
        <h2 className="text-lg font-medium text-neutral-600 mb-2">Nothing here yet</h2>
        <p className="text-neutral-500 text-sm max-w-md">Feature description coming in Epic X.</p>
      </div>
    </div>
  );
}
```

### Imports — Use These Exact Paths

```typescript
// UI components
import { Card, CardHeader, CardTitle, CardContent } from '../../../components/ui/card';
import { SkeletonCard } from '../../../components/skeletons';
import { AlertDialog, AlertDialogContent, AlertDialogHeader, AlertDialogTitle, AlertDialogDescription, AlertDialogFooter, AlertDialogAction, AlertDialogCancel } from '../../../components/ui/alert-dialog';

// Icons (lucide-react)
import { FileSearch, CheckCircle, Shield, Activity, Filter, PieChart, TrendingUp, Download } from 'lucide-react';
```

### Assessor Card Specifications

| Card | Icon | Icon Color | Content |
|------|------|-----------|---------|
| Verification Queue | FileSearch | amber-100/amber-600 | "0 pending reviews" counter |
| Recent Activity | Activity | blue-100/blue-600 | Empty state: "No recent activity" |
| Evidence Panel | Shield | red-100/red-600 | 3 placeholder labels + "Coming in Epic 5" badge |

### Official Card Specifications

| Card | Icon | Icon Color | Content |
|------|------|-----------|---------|
| State Overview | PieChart | slate-100/slate-600 | Read-only stat placeholders (Registrations, Active Surveys, LGAs) |
| Collection Progress | TrendingUp | emerald-100/emerald-600 | Read-only progress bar + "0 / 1,000,000 target" |
| Export Data | Download | blue-100/blue-600 | Single "Export Report" button → "Coming in Epic 5" modal |

### Quick Filters (Assessor Only)

Render as 3 disabled `<select>` dropdowns in a horizontal row:
- "Filter by LGA" (disabled, placeholder)
- "Filter by Enumerator" (disabled, placeholder)
- "Filter by Date Range" (disabled, placeholder)

Style: `bg-gray-50 border border-gray-300 rounded-md px-3 py-2 text-sm text-gray-400 cursor-not-allowed`

### RBAC Route Isolation

Routes are guarded in App.tsx (role names updated in Task 7):
- `/dashboard/assessor/*` → `ProtectedRoute allowedRoles={['verification_assessor']}`
- `/dashboard/official/*` → `ProtectedRoute allowedRoles={['government_official']}`
- Cross-role access redirects to `/unauthorized` → user navigates to `/dashboard` → `DashboardRedirect` routes to correct dashboard
- Verified via `AssessorOfficialRbac.test.tsx` (redirect state assertions included)

### What NOT To Do

- Do NOT add keyboard shortcuts — Assessor/Official are NOT keyboard-optimized roles (unlike Clerk)
- Do NOT add real data fetching — all cards show placeholder/zero data
- Do NOT modify DashboardLayout.tsx — it already handles all roles
- Do NOT modify sidebarConfig.ts — assessor and official configs are already correct
- Do NOT use spinners — always SkeletonCard
- Do NOT add edit/delete buttons to Official dashboard — it's strictly read-only
- Do NOT use React 19 features — locked to React 18.3

### Project Structure Notes

Files to create/modify:
```
apps/web/src/
├── features/dashboard/pages/
│   ├── AssessorHome.tsx              ← MODIFY (replace placeholder)
│   ├── OfficialHome.tsx              ← MODIFY (replace placeholder)
│   ├── AssessorQueuePage.tsx         ← CREATE
│   ├── AssessorCompletedPage.tsx     ← CREATE
│   ├── AssessorEvidencePage.tsx      ← CREATE
│   ├── OfficialStatsPage.tsx        ← CREATE
│   ├── OfficialTrendsPage.tsx       ← CREATE
│   ├── OfficialExportPage.tsx       ← CREATE
│   └── __tests__/
│       ├── AssessorHome.test.tsx     ← CREATE
│       ├── OfficialHome.test.tsx     ← CREATE
│       ├── AssessorSubPages.test.tsx ← CREATE
│       └── OfficialSubPages.test.tsx ← CREATE
├── App.tsx                           ← MODIFY (add lazy imports + child routes)
```

### References

- [Source: _bmad-output/planning-artifacts/epics.md#Story 2.5-7] — Acceptance criteria
- [Source: _bmad-output/planning-artifacts/epics.md#RBAC Access Matrix] — Role isolation rules
- [Source: _bmad-output/planning-artifacts/architecture.md#ADR-016] — Layout architecture
- [Source: _bmad-output/planning-artifacts/ux-design-directions.html#Direction-08] — Government Official formal styling
- [Source: _bmad-output/planning-artifacts/ux-design-specification.md#Journey 3] — Supervisor fraud investigation (Assessor adjacent)
- [Source: _bmad-output/project-context.md] — Loading states, anti-patterns, testing org
- [Source: apps/web/src/features/dashboard/config/sidebarConfig.ts] — Sidebar already configured
- [Source: apps/web/src/App.tsx#L727-781] — Routes already scaffolded with ProtectedRoute

### Previous Story Intelligence (2.5-6)

From Story 2.5-6 (Data Entry Clerk Dashboard) code review:
- **AlertDialogCancel is required** — always include Cancel button in AlertDialog modals (H1 fix)
- **contenteditable guard** — if adding keyboard handlers, check `target.isContentEditable || target.closest?.('[contenteditable]')` (M3 fix)
- **Skeleton layout must match content shape** — skeleton grid should mirror the actual card grid layout (M5 fix)
- **Tab navigation testing** — test with `userEvent.tab()` to verify no focus traps (M4 fix)
- **File list completeness** — always include sprint-status.yaml in File List section (M2 fix)

### Git Intelligence

Recent commit pattern: `feat: [Role] dashboard shell with code review fixes (Story X.X-X)`
- Stories 2.5-4, 2.5-5, 2.5-6 all follow identical dashboard shell pattern
- Each adds home page + sub-pages + tests + App.tsx route updates
- All pass full web test regression suite (800+ tests)
- Last commit: 976b4df (Story 2.5-6) — 851 web tests passing

### Testing Standards

- **Framework:** Vitest + @testing-library/react + @testing-library/jest-dom
- **Location:** Co-located in `__tests__/` folder next to page components
- **Header:** `// @vitest-environment jsdom`
- **Pattern:** `vi.hoisted()` + `vi.mock()` for external deps
- **Render helper:** Wrap in `<MemoryRouter>` for routing context
- **AC mapping:** Each `describe` block maps to an AC number
- **Run:** `cd apps/web && pnpm vitest run` or `pnpm --filter @oslsr/web test`

## Dev Agent Record

### Agent Model Used

Claude Opus 4.6

### Debug Log References

- Fixed `CheckCircle` icon class assertion: lucide-react 0.378.0 aliases `CheckCircle` → `CircleCheckBig`, so DOM class is `.lucide-circle-check-big` (not `.lucide-check-circle`)

### Completion Notes List

- ✅ Task 1: AssessorHome — 3 cards (Verification Queue/amber, Recent Activity/blue, Evidence Panel/red) + Quick Filters (3 disabled selects) + skeleton loading
- ✅ Task 2: OfficialHome — Direction 08 styling (dark header accent, maroon left-border sections, bg-gray-50 field groups) + 3 cards (State Overview/slate, Collection Progress/emerald, Export Data/blue) + "Coming in Epic 5" modal with AlertDialogCancel + read-only enforcement (single Export button only)
- ✅ Task 3: 3 Assessor sub-pages — AssessorQueuePage, AssessorCompletedPage, AssessorEvidencePage (empty state pattern)
- ✅ Task 4: 3 Official sub-pages — OfficialStatsPage, OfficialTrendsPage, OfficialExportPage (empty state pattern)
- ✅ Task 5: App.tsx updated — 6 lazy imports + 6 child routes (3 assessor, 3 official) wrapped in Suspense + DashboardLoadingFallback
- ✅ Task 6: 67 new tests across 5 test files + sidebar config update — 917 total web tests, 0 regressions
- ✅ Task 7: Fixed role name mismatch bug — renamed `clerk`→`data_entry_clerk`, `assessor`→`verification_assessor`, `official`→`government_official` across 2 source files + 5 test files. Root cause: frontend short names didn't match DB/API full names, causing ProtectedRoute to redirect authenticated users to /unauthorized. 917 tests pass after fix.
- Applied all Previous Story Intelligence from 2.5-6: AlertDialogCancel included, skeleton layout matches content shape, tab navigation verified

### Review Follow-ups (AI)

- [x] [AI-Review][HIGH] OfficialHome skeleton layout missing "Overview" section header skeleton — CLS mismatch per PSI M5 [OfficialHome.tsx:42-48] — **FIXED**
- [x] [AI-Review][HIGH] AC10 tab navigation tests only check tabindex attributes, not actual tab traversal with userEvent.tab() per PSI M4 [AssessorHome.test.tsx:129, OfficialHome.test.tsx:154] — **FIXED** (2 new tests added)
- [x] [AI-Review][MEDIUM] AlertDialogAction redundant onClick handler (already handled by onOpenChange) [OfficialHome.tsx:160] — **FIXED** (removed redundant onClick)
- [x] [AI-Review][MEDIUM] Direction 08 field group test used brittle 5-class compound CSS selector [OfficialHome.test.tsx:122] — **FIXED** (replaced with data-testid="field-group")
- [x] [AI-Review][MEDIUM] RBAC tests validate redirect to /unauthorized but AC6-7 specify "redirected to their own dashboard" — **FIXED** (added redirect state assertions verifying `from` path and `requiredRoles` are preserved; documented full chain across test files)
- [x] [AI-Review][LOW] Activity icon rendered twice in AssessorHome (card header + empty state); test querySelector only matches first — **FIXED** (test now uses querySelectorAll and asserts length=2)
- [x] [AI-Review][LOW] Test count documentation: story claimed 62 new tests, actual was 61 — **FIXED** (now 67 total new tests after all review additions, 917 total)
- [x] [AI-Review][LOW] Card count assertion uses shadcn internal data-slot attribute — **FIXED** (replaced with text-based regex query)

### File List

- `apps/web/src/features/dashboard/pages/AssessorHome.tsx` (modified)
- `apps/web/src/features/dashboard/pages/OfficialHome.tsx` (modified)
- `apps/web/src/features/dashboard/pages/AssessorQueuePage.tsx` (new)
- `apps/web/src/features/dashboard/pages/AssessorCompletedPage.tsx` (new)
- `apps/web/src/features/dashboard/pages/AssessorEvidencePage.tsx` (new)
- `apps/web/src/features/dashboard/pages/OfficialStatsPage.tsx` (new)
- `apps/web/src/features/dashboard/pages/OfficialTrendsPage.tsx` (new)
- `apps/web/src/features/dashboard/pages/OfficialExportPage.tsx` (new)
- `apps/web/src/App.tsx` (modified)
- `apps/web/src/features/dashboard/pages/__tests__/AssessorHome.test.tsx` (new)
- `apps/web/src/features/dashboard/pages/__tests__/OfficialHome.test.tsx` (new)
- `apps/web/src/features/dashboard/pages/__tests__/AssessorSubPages.test.tsx` (new)
- `apps/web/src/features/dashboard/pages/__tests__/OfficialSubPages.test.tsx` (new)
- `apps/web/src/features/dashboard/pages/__tests__/AssessorOfficialRbac.test.tsx` (new)
- `apps/web/src/features/dashboard/__tests__/sidebarConfig.test.ts` (modified)
- `apps/web/src/features/dashboard/__tests__/rbac-routes.test.tsx` (modified — Task 7)
- `apps/web/src/features/dashboard/__tests__/DashboardRedirect.test.tsx` (modified — Task 7)
- `apps/web/src/layouts/__tests__/DashboardLayout.test.tsx` (modified — Task 7)
- `apps/web/src/features/dashboard/config/sidebarConfig.ts` (modified — Task 7)
- `_bmad-output/implementation-artifacts/sprint-status.yaml` (modified)
- `_bmad-output/implementation-artifacts/2.5-7-assessor-official-dashboards.md` (modified)

## Change Log

- 2026-02-09: Story 2.5-7 implementation complete — Assessor audit dashboard + Official read-only dashboard with Direction 08 styling. 63 new tests (915 total), 0 regressions.
- 2026-02-09: Code review (AI) — 8 issues found (2H, 3M, 3L). All 8 fixed: skeleton layout mismatch (H1), userEvent.tab() tests (H2), redundant onClick (M1), brittle CSS selector (M2), RBAC redirect state assertions (M3), Activity icon test precision (L1), test count docs (L2), data-slot replaced with text query (L3). 917 total tests, 0 regressions.
- 2026-02-09: Bug fix (Task 7) — clerk/assessor/official roles got "Access Denied" after login. Root cause: frontend used short role names (`clerk`, `assessor`, `official`) but DB/API returns full names (`data_entry_clerk`, `verification_assessor`, `government_official`). Renamed role identifiers across `sidebarConfig.ts`, `App.tsx`, and 5 test files. URL paths and display names unchanged. 917 tests pass, zero stale short identifiers remain.
