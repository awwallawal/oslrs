# Story 2.5.6: Data Entry Clerk Dashboard Shell

Status: done

## Story

As a Data Entry Clerk,
I want a keyboard-optimized dashboard for paper form digitization,
So that I can process hundreds of forms efficiently with a desktop-first, keyboard-primary interface.

## Acceptance Criteria

1. **Given** a Data Entry Clerk logging in, **when** they reach `/dashboard/clerk`, **then** they see a desktop-optimized dashboard with "Start Data Entry" primary CTA, "Today's Progress" card, "Recent Entries" card, and a keyboard shortcuts help section.

2. **Given** the dashboard, **when** the page loads, **then** focus is automatically set to the first actionable element (the "Start Data Entry" button).

3. **Given** the "Start Data Entry" CTA, **when** clicked or Enter pressed, **then** a "Coming in Epic 3" AlertDialog modal appears explaining the native form renderer is being built.

4. **Given** keyboard shortcuts, **then** the following single-key shortcuts work when no input is focused: `N` — triggers Start Data Entry (same as clicking CTA), `?` — shows keyboard shortcuts modal, `Esc` — closes any open modal.

5. **Given** the keyboard shortcuts modal, **when** `?` is pressed, **then** a modal/dialog lists all available shortcuts in a clean reference card format.

6. **Given** the sidebar navigation, **then** Clerk sees exactly 4 items matching sidebarConfig: Home, Entry Queue, Completed, My Stats.

7. **Given** clicking "Entry Queue" / "Completed" / "My Stats" sidebar links, **then** dedicated placeholder pages render with empty-state patterns (icon + message + sub-text).

8. **Given** a Data Entry Clerk attempts to access `/dashboard/super-admin/*` or `/dashboard/supervisor/*` or any other role route, **then** they are redirected (RBAC enforced via existing ProtectedRoute).

9. **Given** the dashboard, **when** rendered in loading state, **then** SkeletonCard components display (never spinners, per ADR-016).

10. **Given** the sub-pages (ClerkQueuePage, ClerkCompletedPage, ClerkStatsPage), **then** they are lazy-loaded with `Suspense` and `DashboardLoadingFallback`, registered as child routes under the clerk route block in App.tsx.

11. **Given** the dashboard, **when** pressing Tab, **then** focus moves sequentially through all interactive elements (CTA button, cards, sidebar links) without focus traps.

## Tasks / Subtasks

- [x] Task 1: Replace ClerkHome.tsx placeholder with full dashboard (AC: 1, 2, 3, 4, 5, 9)
  - [x] 1.1 Add page header (title: "Data Entry Dashboard", subtitle: "Keyboard-optimized paper form digitization")
  - [x] 1.2 Add "Start Data Entry" primary CTA button (Oyo Red bg-primary-600, min-h-[48px], auto-focus via useEffect + useRef)
  - [x] 1.3 Add "Today's Progress" card (emerald, BarChart icon, 0/100 counter + progress bar, placeholder)
  - [x] 1.4 Add "Recent Entries" card (blue, ListOrdered icon, empty state: "No entries yet")
  - [x] 1.5 Add "Coming in Epic 3" AlertDialog modal (same pattern as EnumeratorHome)
  - [x] 1.6 Add keyboard shortcuts section below cards — small reference showing N, ?, Esc
  - [x] 1.7 Implement useEffect for single-key shortcuts (N, ?, Esc) — only active when no input/textarea focused
  - [x] 1.8 Add keyboard shortcuts modal (AlertDialog listing all shortcuts)
  - [x] 1.9 Add skeleton loading branch (`isLoading` prop, default false, 3 SkeletonCards)
  - [x] 1.10 Accept `isLoading` prop for skeleton branch testing

- [x] Task 2: Create 3 placeholder sub-pages (AC: 7, 10)
  - [x] 2.1 Create `ClerkQueuePage.tsx` — "Entry Queue" empty state (ListOrdered icon, "No pending entries", "Forms will appear here when assigned")
  - [x] 2.2 Create `ClerkCompletedPage.tsx` — "Completed Entries" empty state (CheckSquare icon, "No completed entries yet", "Submitted forms will appear here")
  - [x] 2.3 Create `ClerkStatsPage.tsx` — "My Performance Stats" empty state (BarChart icon, "No stats available yet", "Stats will populate as you complete entries")

- [x] Task 3: Register sub-page routes in App.tsx (AC: 10)
  - [x] 3.1 Add lazy imports for ClerkQueuePage, ClerkCompletedPage, ClerkStatsPage
  - [x] 3.2 Add 3 child Routes under the clerk route block (path="queue", path="completed", path="stats")
  - [x] 3.3 Each wrapped in `<Suspense fallback={<DashboardLoadingFallback />}>`

- [x] Task 4: Write tests (AC: 1-11)
  - [x] 4.1 Create `ClerkHome.test.tsx` in `pages/__tests__/`
    - Renders page title and subtitle
    - Renders 2 dashboard cards with correct titles
    - Renders "Start Data Entry" CTA button
    - CTA has auto-focus on mount
    - Click CTA opens "Coming in Epic 3" modal
    - Skeleton loading branch renders 3 SkeletonCards when isLoading=true
    - Keyboard shortcut `N` triggers modal
    - Keyboard shortcut `?` opens shortcuts modal
    - Keyboard shortcut `Esc` closes modal
    - Keyboard shortcuts section visible
    - Tab moves sequentially through interactive elements without focus traps (AC11)
  - [x] 4.2 Create `ClerkQueuePage.test.tsx` — renders title, empty state message
  - [x] 4.3 Create `ClerkCompletedPage.test.tsx` — renders title, empty state message
  - [x] 4.4 Create `ClerkStatsPage.test.tsx` — renders title, empty state message

- [x] Task 5: Verify no regressions
  - [x] 5.1 Run full web test suite (`cd apps/web && pnpm vitest run`)
  - [x] 5.2 Verify all existing dashboard tests pass (RBAC, sidebar config, other role pages)

## Dev Notes

### Architecture Compliance

- **MUST** use existing `DashboardLayout` from Story 2.5-1 — do NOT create new layouts
- **MUST** use `SkeletonCard` for loading states — NEVER spinners (ADR-016)
- **MUST** follow ProtectedRoute pattern: `allowedRoles={['clerk']}` already in App.tsx
- **MUST** use lazy loading with `Suspense` for sub-pages (established pattern)
- Sidebar config already defined in `sidebarConfig.ts` — 4 items for clerk role, do NOT modify
- Route guard already exists at `apps/web/src/App.tsx:672-698`

### Keyboard-First Design (Story Differentiator)

This story is unique vs supervisor/enumerator because it's **desktop-first, keyboard-optimized**:
- Auto-focus the CTA button on mount (useEffect + useRef)
- Single-key shortcuts (N, ?, Esc) — listen on `document` keydown, gate on `event.target` not being input/textarea
- Tab navigation through cards must work without traps
- The actual keyboard-optimized form entry experience is Epic 3 Story 3.6; this story establishes the foundation

### Card Layout Pattern (Desktop-First)

Unlike EnumeratorHome (mobile-first `flex flex-col gap-4 md:grid`), ClerkHome should use the desktop grid pattern since clerks work on desktops:
```tsx
<div className="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
```
But since we only have 2 content cards + the CTA, use `md:grid-cols-2` (same as current placeholder).

### Dashboard Cards

| Card | Color | Icon | Content |
|------|-------|------|---------|
| Today's Progress | emerald (`bg-emerald-100 text-emerald-600`) | BarChart | `0 / 100 forms today` + progress bar at 0% |
| Recent Entries | blue (`bg-blue-100 text-blue-600`) | ListOrdered | Empty state: "No entries yet" |

### CTA Button Pattern

Follow EnumeratorHome pattern exactly:
```tsx
<button
  ref={ctaRef}
  onClick={() => setShowEpic3Modal(true)}
  className="w-full md:w-auto min-h-[48px] px-8 py-3 bg-primary-600 hover:bg-primary-700 text-white font-semibold rounded-lg text-lg transition-colors"
>
  Start Data Entry
</button>
```
Add auto-focus:
```tsx
const ctaRef = useRef<HTMLButtonElement>(null);
useEffect(() => { ctaRef.current?.focus(); }, []);
```

### AlertDialog Pattern (Coming in Epic 3)

Reuse exact pattern from EnumeratorHome:
```tsx
<AlertDialog open={showEpic3Modal} onOpenChange={setShowEpic3Modal}>
  <AlertDialogContent>
    <AlertDialogHeader>
      <AlertDialogTitle>Coming in Epic 3</AlertDialogTitle>
      <AlertDialogDescription>
        The keyboard-optimized form entry interface is being built in Epic 3.
        Once complete, you'll be able to digitize paper forms with full
        keyboard navigation — Tab, Enter, and shortcut keys for maximum speed.
      </AlertDialogDescription>
    </AlertDialogHeader>
    <AlertDialogFooter>
      <AlertDialogCancel>Cancel</AlertDialogCancel>
      <AlertDialogAction onClick={() => setShowEpic3Modal(false)}>Got it</AlertDialogAction>
    </AlertDialogFooter>
  </AlertDialogContent>
</AlertDialog>
```

### Keyboard Shortcuts Implementation

```tsx
useEffect(() => {
  const handleKeyDown = (e: KeyboardEvent) => {
    const target = e.target as HTMLElement;
    if (target.tagName === 'INPUT' || target.tagName === 'TEXTAREA' || target.isContentEditable) return;

    switch (e.key.toLowerCase()) {
      case 'n':
        e.preventDefault();
        setShowEpic3Modal(true);
        break;
      case '?':
        e.preventDefault();
        setShowShortcutsModal(true);
        break;
      case 'escape':
        setShowEpic3Modal(false);
        setShowShortcutsModal(false);
        break;
    }
  };
  document.addEventListener('keydown', handleKeyDown);
  return () => document.removeEventListener('keydown', handleKeyDown);
}, []);
```

### Empty State Sub-Page Pattern

Follow established pattern from EnumeratorSurveysPage / SupervisorTeamPage:
```tsx
export default function ClerkQueuePage() {
  return (
    <div className="p-6">
      <div className="mb-6">
        <h1 className="text-2xl font-brand font-semibold text-neutral-900">Entry Queue</h1>
        <p className="text-neutral-600 mt-1">Forms awaiting digitization</p>
      </div>
      <Card>
        <CardContent className="flex flex-col items-center justify-center py-16 text-center">
          <ListOrdered className="w-12 h-12 text-neutral-300 mb-4" />
          <p className="text-neutral-500 font-medium">No pending entries</p>
          <p className="text-sm text-neutral-400 mt-1">Forms will appear here when assigned</p>
        </CardContent>
      </Card>
    </div>
  );
}
```

### Testing Patterns

- Use `vi.hoisted()` + `vi.mock()` for react-router-dom `useNavigate`
- CardTitle renders as `div[data-slot="card-title"]` not `h3` — use appropriate selectors
- Skeleton branch: test with `<ClerkHome isLoading={true} />` prop
- Keyboard events: use `fireEvent.keyDown(document, { key: 'n' })` for shortcut tests
- Test files go in `apps/web/src/features/dashboard/pages/__tests__/`
- Run web tests with: `cd apps/web && pnpm vitest run`

### Sidebar Config Discrepancy Note

The epics file AC7 says sidebar should show "Dashboard, Active Forms, Completed, Help". However, `sidebarConfig.ts` (established in Story 2.5-1, the single source of truth) already defines: "Home, Entry Queue, Completed, My Stats". **Follow the sidebarConfig.ts** — it was set through the architectural story and reviewed. Do NOT modify sidebarConfig.

### Dropped `D` Keyboard Shortcut Note

Epic AC5 includes `D - View drafts` shortcut, but the clerk sidebar has no Drafts page (sidebarConfig source of truth: Home, Entry Queue, Completed, My Stats). The `D` shortcut is intentionally omitted — deferred until a relevant destination exists in a future story.

### Project Structure Notes

- All clerk pages: `apps/web/src/features/dashboard/pages/Clerk*.tsx`
- All clerk tests: `apps/web/src/features/dashboard/pages/__tests__/Clerk*.test.tsx`
- Route registration: `apps/web/src/App.tsx` (clerk block at ~line 672)
- Sidebar config: `apps/web/src/features/dashboard/config/sidebarConfig.ts` (clerk at line 116)
- Naming convention: `ClerkHome`, `ClerkQueuePage`, `ClerkCompletedPage`, `ClerkStatsPage`

### Component Imports

```tsx
// UI Components (shadcn)
import { Card, CardHeader, CardTitle, CardContent } from '../../../components/ui/card';
import { SkeletonCard } from '../../../components/skeletons';
import {
  AlertDialog, AlertDialogContent, AlertDialogHeader,
  AlertDialogTitle, AlertDialogDescription, AlertDialogFooter,
  AlertDialogAction, AlertDialogCancel,
} from '../../../components/ui/alert-dialog';

// Icons (lucide-react)
import { BarChart, ListOrdered, CheckSquare, Keyboard } from 'lucide-react';
```

### References

- [Source: _bmad-output/planning-artifacts/epics.md#Epic 2.5 Story 2.5-6]
- [Source: _bmad-output/planning-artifacts/architecture.md#ADR-016 Layout Architecture]
- [Source: _bmad-output/planning-artifacts/ux-design-specification.md#Journey 4 Paper Form Digitization]
- [Source: apps/web/src/features/dashboard/config/sidebarConfig.ts#clerk]
- [Source: apps/web/src/features/dashboard/pages/EnumeratorHome.tsx — CTA + modal pattern]
- [Source: apps/web/src/features/dashboard/pages/SupervisorHome.tsx — card grid pattern]
- [Source: _bmad-output/implementation-artifacts/2.5-5-enumerator-dashboard-shell.md — previous story learnings]
- [Source: _bmad-output/implementation-artifacts/2.5-4-supervisor-dashboard-shell.md — card pattern]

### Previous Story Intelligence

**From Story 2.5-5 (Enumerator Dashboard):**
- CardTitle renders as `div[data-slot="card-title"]` not `h3` — test selectors must match
- Service worker mocking: `vi.stubGlobal('navigator', ...)` in jsdom
- AlertDialog requires both `AlertDialogCancel` and `AlertDialogAction` buttons
- Sync Status badge must be outside the loading guard (visible even when loading)
- Use `vi.hoisted()` for mock setup, NOT inline vi.fn()
- DashboardLayout test had hardcoded sidebar labels — if you change labels, update the test

**From Story 2.5-4 (Supervisor Dashboard):**
- Stale comments in sidebarConfig were flagged — keep comments accurate
- Test comments must match actual assertions
- Use fake timers for timestamp testing if implementing "Last Updated"
- Icon verification tests help catch import mistakes

### Git Intelligence

Recent commits show consistent patterns:
- `c7798cc` feat: Enumerator dashboard shell with code review fixes (Story 2.5-5)
- `1d4d2a1` feat: Supervisor dashboard shell with team overview, alerts, and collection cards (Story 2.5-4)

Both dashboard shells follow the same structure: replace placeholder → add cards → add sub-pages → add routes → add tests. This story follows the identical pattern.

## Dev Agent Record

### Agent Model Used

Claude Opus 4.6 (claude-opus-4-6)

### Debug Log References

- Initial test run: 3 failures (icon CSS class names `lucide-chart-bar` should be `lucide-bar-chart`, duplicate "Keyboard Shortcuts" text when modal opens). Fixed by correcting icon class names and using `getAllByText` + `getByRole('alertdialog')` for modal assertion.

### Completion Notes List

- Replaced ClerkHome.tsx placeholder with full keyboard-optimized dashboard: page header, "Start Data Entry" CTA with auto-focus, "Today's Progress" card (emerald, 0/100 counter + progress bar), "Recent Entries" card (blue, empty state), keyboard shortcuts inline section, "Coming in Epic 3" AlertDialog, keyboard shortcuts modal AlertDialog, skeleton loading branch (3 SkeletonCards).
- Implemented single-key shortcuts (N, ?, Esc) with input/textarea guard on document keydown.
- Created 3 placeholder sub-pages (ClerkQueuePage, ClerkCompletedPage, ClerkStatsPage) with empty-state patterns matching established EnumeratorSurveysPage pattern.
- Registered 3 lazy-loaded child routes in App.tsx under clerk route block (queue, completed, stats) with Suspense + DashboardLoadingFallback.
- Created 4 test files: ClerkHome.test.tsx (18 tests), ClerkQueuePage.test.tsx (3 tests), ClerkCompletedPage.test.tsx (3 tests), ClerkStatsPage.test.tsx (3 tests). All 27 tests pass.
- Full regression suite: 81 test files, 850 tests, 0 failures.
- Did NOT modify sidebarConfig.ts (sidebar already configured for clerk in Story 2.5-1).
- RBAC already enforced via existing ProtectedRoute with `allowedRoles={['clerk']}` (AC8 covered by existing infrastructure).

### File List

- `apps/web/src/features/dashboard/pages/ClerkHome.tsx` (modified) — Full dashboard replacement
- `apps/web/src/features/dashboard/pages/ClerkQueuePage.tsx` (new) — Entry Queue placeholder
- `apps/web/src/features/dashboard/pages/ClerkCompletedPage.tsx` (new) — Completed Entries placeholder
- `apps/web/src/features/dashboard/pages/ClerkStatsPage.tsx` (new) — My Stats placeholder
- `apps/web/src/App.tsx` (modified) — Added lazy imports + child routes for clerk sub-pages
- `apps/web/src/features/dashboard/pages/__tests__/ClerkHome.test.tsx` (new) — 18 tests
- `apps/web/src/features/dashboard/pages/__tests__/ClerkQueuePage.test.tsx` (new) — 3 tests
- `apps/web/src/features/dashboard/pages/__tests__/ClerkCompletedPage.test.tsx` (new) — 3 tests
- `apps/web/src/features/dashboard/pages/__tests__/ClerkStatsPage.test.tsx` (new) — 3 tests
- `_bmad-output/implementation-artifacts/sprint-status.yaml` (modified) — Updated 2.5-6 status backlog → review

### Senior Developer Review (AI)

**Reviewer:** Code Review Workflow (Adversarial)
**Date:** 2026-02-09
**Issues Found:** 1 High, 4 Medium, 2 Low
**Issues Fixed:** 1 High, 4 Medium (all auto-fixed)

| # | Severity | Description | File | Status |
|---|----------|-------------|------|--------|
| H1 | HIGH | Shortcuts modal missing AlertDialogCancel button | ClerkHome.tsx:199 | Fixed |
| M1 | MEDIUM | sprint-status.yaml not in File List | story file | Fixed |
| M2 | MEDIUM | Keyboard shortcut guard missing closest('[contenteditable]') check | ClerkHome.tsx:42 | Fixed |
| M3 | MEDIUM | AC11 tab navigation test only checks tabindex, not actual focus movement | ClerkHome.test.tsx:159 | Fixed |
| M4 | MEDIUM | Skeleton layout (3 cards) doesn't match content layout (CTA + 2 cards) | ClerkHome.tsx:77 | Fixed |
| L1 | LOW | project-context.md documents /dashboard/data-entry/* but actual route is /dashboard/clerk (pre-existing from 2.5-1) | project-context.md:1104 | Noted |
| L2 | LOW | Verbose JSDoc AC references in component header | ClerkHome.tsx:1-11 | Noted |

**Post-fix test results:** 81 test files, 851 tests, 0 failures (net +1 from split AC11 test).

## Change Log

- 2026-02-09: Implemented Data Entry Clerk dashboard shell with keyboard-optimized design (Story 2.5-6). Replaced placeholder with full CTA, cards, keyboard shortcuts, modals, sub-pages, routes, and 27 tests. 850 total web tests pass, 0 regressions.
- 2026-02-09: Code review — 7 findings (1H, 4M, 2L). Fixed 5 issues: added AlertDialogCancel to shortcuts modal (H1), added sprint-status.yaml to File List (M1), hardened keyboard shortcut guard for contenteditable (M2), strengthened AC11 tab test (M3), fixed skeleton layout to match content shape (M4). 851 tests pass, 0 regressions.
